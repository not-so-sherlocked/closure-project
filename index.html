<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Letter</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
/* --- Styles (same as before, minor tweaks) --- */
* {margin:0; padding:0; box-sizing:border-box;}
body {background:#e8e1d1; min-height:100vh; font-family:'Crimson Text', serif; color:#3a3226; display:flex; justify-content:center; align-items:center; padding:40px 20px; line-height:1.7; background-image:url('https://www.transparenttextures.com/patterns/old-map.png');}
.letter-container {max-width:800px;width:100%;position:relative;padding:20px 0;}
.letter {background:#f8f4e8; padding:60px 50px; border-radius:2px; box-shadow:0 2px 10px rgba(0,0,0,0.1), inset 0 0 100px rgba(214,191,157,0.3); position:relative; border:1px solid #d8d1c0; background-image:url('https://www.transparenttextures.com/patterns/rice-paper-3.png'); background-blend-mode:multiply;}
.letter::before{content:'';position:absolute;top:10px;left:10px;right:10px;bottom:10px;border:1px solid #a8946b33;pointer-events:none;}
.letter::after{content:'';position:absolute;top:0;left:0;right:0;height:15px;background:linear-gradient(135deg,transparent 95%,rgba(0,0,0,0.05) 96%,transparent 97%);}
.checkpoint{position:relative;margin:30px 0;padding:20px 0;}
.checkpoint-line{margin-bottom:15px;font-size:18px;color:#5d4b36;}
.arrow-container{text-align:center;margin:20px 0;}
.arrow{cursor:pointer;display:inline-block;font-size:0;width:40px;height:40px;border:2px solid #d4c4a0;border-radius:50%;background:rgba(212,196,160,0.1);position:relative;transition:all 0.3s ease;margin:10px 0;}
.arrow:hover{background:rgba(212,196,160,0.3);transform:translateY(2px);box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.arrow::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-60%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:12px solid #7a6b56;}
.preview-text{font-style:italic;color:#8a7b66;margin:15px 0;padding:15px;filter:blur(2px);user-select:none;transition:filter 0.3s ease;}
.highlight {
  background: linear-gradient(90deg, rgba(233, 163, 2, 0.4) 50%, transparent 50%);
  background-size: 200% 100%;
  background-position: right bottom;
  transition: background-position 5s linear; /* slower */
  padding: 2px 0;
}

.highlight.active {
  background-position: left bottom; /* <-- this change triggers the animation */
}
.highlight.active{background-position:left bottom;}
.options{margin-top:20px;display:none;text-align:center;animation:fadeIn 0.5s ease-in-out;}
.options button{margin:0 15px 10px 0;padding:12px 24px;cursor:pointer;border:1px solid #d4c4a0;border-radius:4px;background:rgba(248,244,232,0.9);color:#5d4b36;font-family:'Crimson Text', serif;font-size:16px;transition:all 0.3s ease;position:relative;overflow:hidden;}
.options button:hover{background:rgba(212,196,160,0.3);transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.options button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s;}
.options button:hover::before{left:100%;}
.hidden{display:none;}
.rest1,.rest2{animation:slideDown 0.6s ease-out;}
p{margin-bottom:20px;text-align:justify;font-size:18px;color:#5d4b36;}
.letter-heading{font-family:'Playfair Display', serif;font-size:32px;margin-bottom:30px;color:#5d4b36;text-align:left;}
.signature {
  text-align: right;
  font-style: italic;
  margin-top: 40px;
  color: #5d4b36;
  font-family: 'Merriweather', serif;
  font-size: 18px;
}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px);max-height:0;}to{opacity:1;transform:translateY(0);max-height:2000px;}}
@media (max-width:768px){.letter{padding:40px 30px;}.letter-heading{font-size:28px;}p{font-size:16px;}.options button{display:block;width:100%;margin:10px 0;}}
.thank-you-page{text-align:center;padding:60px 0;}
.thank-you-page h1{font-family:'Playfair Display', serif;font-size:36px;color:#5d4b36;margin-bottom:30px;}
.thank-you-page p{font-size:20px;color:#7a6b56;margin:20px 0;}
.loading{opacity:0.6;pointer-events:none;position:relative;}
.loading::after{content:'';position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #d4c4a0;border-top:2px solid #7a6b56;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.reveal-name{font-weight:bold;color:#c94c4c;cursor:pointer;transition:color 0.3s;}
.reveal-name:hover{color:#ff6b6b;}
.identity.hidden{display:none;font-weight:bold;color:#4a4a4a;}
.final-div {
  text-align: center;
  margin-top: 80px;
  padding: 20px 0;
  font-size: 16px;
  color: #5d4b36;
  font-family: 'Crimson Text', serif;
  border-top: 1px solid rgba(90, 70, 40, 0.2);
  
}

.final-div a {
  color: #c94c4c;  /* a warm accent for the link */
  text-decoration: none;
  font-weight: bold;
}

.final-div a:hover {
  text-decoration: underline;
}
.lastnote{
  text-align: center;
  font-size: 14px;
}
</style>
</head>
<body>
<div class="letter-container">
<div class="letter">
<p class="letter-heading">Dear ,</p>

<p>First of all, I want to apologize for breaking a kind of promise I once made  that I would never come to you again.
   I know I had already said goodbye forever,
   but here I am once more.</p>

<!-- First checkpoint -->
<div class="checkpoint">
  <div class="checkpoint-line">
    <span id="line1">If you feel that what I'm about to say is unnecessary or unwanted, please feel free to leave it unread. I will understand.</span>
  </div>

  <div class="preview-text" id="preview1">
    Hello, it's me again. Last time, I sent you a letter from an anonymous address...
    Your curiosity eventually led you to find out who I am 
    some dummy person who had no real idea about your personal life.
    But I still wanted to say this to you.
  </div>

  <div class="arrow-container">
    <div class="arrow" onclick="reveal(this, 'line1', 'preview1')"></div>
  </div>

  <div class="options">
    <button onclick="proceed(this, 'rest1')">I understood</button>
    <button onclick="leave(this)">Leave</button>
  </div>
</div>

<div class="hidden rest1">
<p>
Hello, it's me again. Last time, I sent you a letter from an anonymous address.
 Your curiosity eventually led you to find out who I am but, as I wished, you chose to keep it unspoken. 
 I respect you deeply for that, and I always will. Still, 
<span class="reveal-name" onclick="showIdentity(this)">I am right here.</span>
<span class="identity hidden"> I am Jeevandas M S.</span>
</p>
<p>In my last letter, my only intention was to free myself from an illusion I had carried for a long time,
   or to find closure for a story where, without realizing it, you became the main character.</p>

<p>From that last letter, what I truly wished for was a clear closure, so I could finally move on from a story that never really began.
   Yet writing it gave me relief from a weight I had carried with me for so long. For the first time, I felt as if I had set something down 
   outside of my universe.</p>

<p>And here I am again, with something to confess. But before that, I want to say this: I have no real idea about your personal life your dreams,
   goals, struggles, or even if your story has already begun with someone else.</p>

<!-- Second checkpoint -->
<div class="checkpoint">
  <div class="checkpoint-line">
    <span id="line2">If that is the case, and you already belong to someone,
       then please stop reading here. I would never want to intrude or cross your boundaries.
       I will understand and respect that completely.</span>
  </div>

  <div class="preview-text" id="preview2">
    If you are still reading this, I will take it as a sign that you do not already belong to someone else...
        Your curiosity eventually led you to find out who I am —
    some dummy person who had no real idea about your personal life.
    But I still wanted to say this to you.
  </div>

  <div class="arrow-container">
    <div class="arrow" onclick="reveal(this, 'line2', 'preview2')"></div>
  </div>

  <div class="options">
    <button onclick="proceed(this, 'rest2')">I understood</button>
    <button onclick="leave(this)">Leave</button>
  </div>
</div>
</div>

<div class="hidden rest2">
<p>If you are still reading this, I will take it as a sign that you do not already belong to someone else that you are single.</p>

<p>Weeks after the closure letter I sent you, the idea of you had not really faded from me.
   Perhaps it's because those feelings had lived within me for so long, and I believe that deep wounds take time to heal.
    I left it to time to carry me forward.</p>

<p>Even now,all these days later, I find that the idea of you still remains with me,
  carrying the same excitement and curiosity as before. A part of me still quietly hopes for you. 
  I know you would never give me a false hope, and I respect that.</p>

<p>I like you for a reason, a reason I cannot always explain may be you are the most gorgeous one my soul has ever met. 
  I also understand how awkward it must feel to hear all of this from someone you hardly know. But at this moment,
   I just want to be honest with myself, and with you.</p>

<p>I am sorry if any of my words have disturbed you  that was never my intention. I only wished to express myself honestly, 
  so that I wouldn't be left with the regret of "what if."</p>

<p>And finally, I will admit that a small part of me still hopes for you. If you ever feel something real for me, 
  just let me know. I will keep the doors open until life carries me somewhere else.</p>

<p class="signature">Goodbye, until we meet again  may be somewhere near the edge of the universe.</p>

 <div class="arrow-container">
    <div class="arrow" onclick="conclution()"></div>
  </div>

</div>
</div>
</div>

<script>
// Track function
async function trackAction(action, data = {}) {
  try {
    const trackingData = {
      action: action,
      checkpointId: data.checkpoint || '',
      decision: data.decision || '',
      userAgent: navigator.userAgent,
      url: window.location.href,
      extraData: data.extraData || {}
    };
    try {
      const ipResponse = await fetch('https://api.ipify.org?format=json');
      const ipData = await ipResponse.json();
      trackingData.ip = ipData.ip;
    } catch (e) {
      trackingData.ip = 'unavailable';
    }
    await fetch('https://love-link-mtyd.onrender.com/api/button/submit', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(trackingData)
    });
  } catch(e) { console.error(e); }
}

// Identity toggle
function showIdentity(span) {
  const identity = span.nextElementSibling;
  if(identity) identity.classList.toggle('hidden');
}

// Reveal arrow
function reveal(arrow,lineId,previewId){
  trackAction('arrow_clicked',{checkpoint:lineId,scenario:'reveal_content'});
  const line=document.getElementById(lineId);
  const preview=document.getElementById(previewId);
  line.classList.add("highlight");
  setTimeout(()=>line.classList.add("active"),100);
  arrow.closest('.checkpoint').querySelector('.options').style.display="block";
  arrow.style.display="none";

  // Remove preview completely once options appear
  if(preview) preview.remove();
}

// Proceed button
function proceed(btn, sectionClass){
  btn.classList.add('loading');
  const checkpointId = btn.closest('.checkpoint').querySelector('.checkpoint-line span').id;
  trackAction('button_clicked',{
    checkpoint: checkpointId,
    action:'proceed',
    decision:'continue_reading',
    extraData:{sectionClass}
  });
  setTimeout(()=>{
    const targetSection=document.querySelector('.'+sectionClass);
    if(targetSection) targetSection.classList.remove('hidden');
    btn.closest(".checkpoint").querySelector(".options").style.display="none";
    btn.classList.remove('loading');
  },500);
}

// Leave button
function leave(btn){
  const checkpointId = btn.closest('.checkpoint').querySelector('.checkpoint-line span').id;
  trackAction('button_clicked',{checkpoint:checkpointId,action:'leave',decision:'stop_reading'});
  btn.classList.add('loading');
  setTimeout(()=>{
    document.body.innerHTML=`
    <div class="letter-container">
      <div class="letter">
        <div class="thank-you-page custom-thank-theme">
          <h1>Thank you for reading until here.</h1>
          <video width="100%" autoplay muted loop>
            <source src="video.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <style>
.video-frame {
  border: 4px solid #333;       /* dark neat border */
  border-radius: 10px;           /* rounded corners */
  box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* subtle shadow for depth */
}
</style>

          <p>
            I know what I’m doing may seem wrong  opening a closed chapter isn’t always easy. But my intention was only to live the rest of my life without the regret of 'what if.' Thank you for listening so far."</p>
    </div>
    `;
    trackAction('page_view',{action:'page_view',extraData:{page:'thank_you',scenario:'early_exit'}});
  },800);
}

function conclution(){
  trackAction('page_view',{action:'page_view',extraData:{page:'thank_you',scenario:'final_exit'}});
  document.body.innerHTML=`
    <div class="letter-container">
      <div class="letter">
        <div class="thank-you-page custom-thank-theme">
          <h1>Thank you for reading until here.</h1>
                    <video width="100%" autoplay muted loop>
            <source src="video.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <style>
.video-frame {
  border: 4px solid #333;       /* dark neat border */
  border-radius: 10px;           /* rounded corners */
  box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* subtle shadow for depth */
}
</style>

          <p>I don’t know what led you this far  maybe curiosity, maybe something else. If so, 
            please don’t mind my words; I only wish for you to be clear in your own way.

I know what I’m doing may seem wrong  opening a closed chapter isn’t always my thing.My intention 
is only to live the rest of my life without the regret of 'what if.' Thank you for listening so far.</p>
        </div>

      </div>
<div class="final-div">
  <p class="lastnote">All these words are polished with various tools, but the feelings are real.</p>
  <p class="lastnote">Made with love ❤️ by <a href="https://github.com/jeevandas-jd" target="_blank" rel="noopener noreferrer">Jeevandas</a></p>
</div>

     
    </div>`;
}
// Track page load
window.addEventListener('load',()=>trackAction('page_load',{page:'letter',scenario:'initial_visit'}));
document.addEventListener('visibilitychange',()=>trackAction('visibility_change',{hidden:document.hidden,scenario:document.hidden?'user_left_page':'user_returned_to_page'}));
</script>
</body>
</html>
